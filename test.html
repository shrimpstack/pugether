<!DOCTYPE html>
<html lang="zh-Hant">
	<head>
		<title>測試</title>
		<meta charset="utf-8">
		<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
		<style>
			#試寫, #試寫結果 { min-height:18px; margin:10px; width:300px; border:2px solid #FFF; padding:5px; border-radius:5px; }
			a { position:relative; }
			a:hover:before { content:"我是一般網址。"; width:max-content; color:#000; background:#FFF; z-index:9; display:block; position:absolute; top:calc(100% + 5px); left:0; }
			a.plurkpaste:hover:before { content:"我是噗貼。"; }
		</style>
	</head>
	<body style="background:#AAA;">
		<div>這邊打字測試↓</div><div id="試寫" contenteditable></div>
		<button id="點我測試">點我測試</button>
		<button id="清空格式">清空格式</button>
		<button id="測試變色">測試變色</button>
		<div>這裡看結果：↓</div><div id="試寫結果"></div>
		<h3>可測試：</h3>
		<div style="padding-left:20px">
			[顏色 文字]可使用：#xxx三位數色碼、#xxxxxx六位數色碼、顏色名<br>
			[b-背景顏色 顏色 文字]可使用：#xxx三位數色碼、#xxxxxx六位數色碼、顏色名<br>
			<a href="https://shrimpstack.000webhostapp.com/pugether/color.html" target="_blank">可使用的顏色名字列表</a><br>
			**粗體**<br>
			*斜體*<br>
			--刪除線--<br>
			__底線__<br>
			^^上標^^<br>
			vv下標vv<br>
			#5字體大小5<br>
			#4字體大小4<br>
			#3字體大小3<br>
			#2字體大小2<br>
			#1字體大小1<br>
			http:網址變成https:網址<br>
			https://www.plurk.com/ (名稱) 變成：<a href="https://www.plurk.com/" target="_blank" class="ex_link">名稱</a><br>
			https://paste.plurk.com/show/dsmr5KRZr5oKHvKAI5Ok/ (噗貼名稱) 變成：<a href="https://paste.plurk.com/show/dsmr5KRZr5oKHvKAI5Ok/" target="_blank" class="ex_link plurkpaste">噗貼名稱</a><br>
			https://images.plurk.com/6M9QuERPoQ2SRWgQ6f9vI1.png 變成：<img src="https://images.plurk.com/6M9QuERPoQ2SRWgQ6f9vI1.png">
		</div>
		<h3>可測試骰子：</h3>
		<div style="padding-left:20px">
			<img src="https://s.plurk.com/emoticons/random/d4e02922f336b3fc37df.gif"> (猜拳)(剪刀石頭布)(rock-paper-scissors)(paper-scissors-stone)<br>
			<img src="https://s.plurk.com/emoticons/random/19aaf586d123ed95a4d9.png"> (抽籤)(lots)<br>
			<img src="https://s.plurk.com/emoticons/random/6a243a33d6bc7459e4f9.png"> (內褲)(胖次)(panties)(underpants)(neiku)(パンツ)<br>
			<img src="https://s.plurk.com/emoticons/random/d507b324a36b6ea37d41.png"> (硬幣)(coin)<br>
			<img src="https://s.plurk.com/emoticons/random/dc596798287f11c05809.png"> (四面骰)(dice4)<br>
			<img src="https://s.plurk.com/emoticons/random/72d18a49f6c6619c7c9e.png"> (六面骰)(骰子)(dice6)<br>
			<img src="https://s.plurk.com/emoticons/random/af9f5a32a5330e19e713.png"> (dice2)<br>
			<img src="https://s.plurk.com/emoticons/random/def92e11a48e30c83e22.png"> (八面骰)(dice8)<br>
			<img src="https://s.plurk.com/emoticons/random/b7211fe31f31a313972b.png"> (十面骰)(dice10)<br>
			<img src="https://s.plurk.com/emoticons/random/14a82a94262e04e87a0f.png"> (十二面骰)(dice12)<br>
			<img src="https://s.plurk.com/emoticons/random/e50a1234389ce7d0fa2d.png"> (二十面骰)(dice20)<br>
			<img src="https://s.plurk.com/emoticons/random/2395f06061976e760876.png"> (數字骰)(digit)(dice09)<br>
			<img src="https://s.plurk.com/emoticons/random/b6ef58ae5a0aa2b9b695.png"> (擲筊)(bobei)<br>
			<img src="https://s.plurk.com/emoticons/random/d266f2b19c50547d685a.png"> (拉霸)(拉霸機)(吃角子老虎)(柏青嫂)(slot)(777)(pachislot)(パチスロ)<br>
			<img src="https://s.plurk.com/emoticons/special/19acfc995b239be115f8.png"> (bz)(bzz)(bzzz)
		</div>
		<h3>可測試表符：</h3>
		<div style="padding-left:20px">
			<img src="https://s.plurk.com/emoticons/basic2/2e948ae7195e68b97ac54fa5bc93245e.gif" class="emoticon"> [肉骨獸]<br>
			<img class="emoticon_my" src="https://emos.plurk.com/620e94a857470c40343878c0e558dc21_w24_h24.gif"> [愛心]<br>
			<img class="emoticon_my" src="https://emos.plurk.com/4609627770b8cfbe9b1599923adc3ff6_w24_h24.gif"> [害羞]<br>
			<img class="emoticon_my" src="https://emos.plurk.com/186b1b32c713cbe4ef80614182c96a34_w24_h24.gif"> [亮晶晶]<br>
			<img class="emoticon_my" src="https://emos.plurk.com/1a848972c81d725e42351b8cfeee1177_w24_h24.gif"> [小花]<br>
			<img class="emoticon_my" src="https://emos.plurk.com/1ca072ff2eb1d46f858648976603e80b_w24_h24.gif"> [火]<br>
			<img class="emoticon_my" src="https://emos.plurk.com/ada878bee0cc24df7af91b8f227bc2fa_w24_h24.gif"> [咖啡]<br>
			<img class="emoticon_my" src="https://emos.plurk.com/4c9ff96ad6d23cf4c4b199db249454cc_w24_h24.gif"> [汗滴]<br>
			<img class="emoticon_my" src="https://emos.plurk.com/5aecebfa3df284d293cd16fa006238b4_w24_h24.gif"> [zzz]<br>
			<img class="emoticon_my" src="https://emos.plurk.com/8e67570973b3ff9a77888a773d974fec_w48_h48.gif"> [大笑]<br>
		</div>
		<script>
			$(document).ready(() => {
				$('[alt="www.000webhost.com"]').parents('div').remove();
				$('[contenteditable]').on('paste', (e) => {
					e.preventDefault();
					var text = '';
					if (e.clipboardData || e.originalEvent.clipboardData) text = (e.originalEvent || e).clipboardData.getData('text/plain');
					else if (window.clipboardData) text = window.clipboardData.getData('Text');
					if (document.queryCommandSupported('insertText')) document.execCommand('insertText', false, text);
					else document.execCommand('paste', false, text);
				});
				$('#清空格式').click(() => {
					let content = $('#試寫').html();
					$('#試寫').html(content.replace(/<span (.*?)>(.*?)<\/span>/ig, '$2').replace(/&nbsp;/ig, ' '));
				});
				$('#點我測試').click(() => {
					let content = diceReplace($('#試寫').html());
					$('#試寫結果').html(content);
				});
				$('#測試變色').click(() => {
					var t = '';
					if (window.getSelection) t = window.getSelection();
					else if (document.getSelection) t = document.getSelection();
					else if (document.selection) t = document.selection.createRange().text;
					return t;
				});
			});
			
			function diceReplace(content) {
				for(let f in ms) {
					let re = new RegExp(ms[f][0], 'ig');
					console.log(content.search(re));
					while(content.search(re) > -1) {
						content = content.replace(re, ms[f][1]);
					}
				}
				content = content
				.replace(/\*\*(.*?)\*\*/ig, '<b>$1</b>')
				.replace(/\*(.*?)\*/ig, '<i>$1</i>')
				.replace(/--(.*?)--/g, '<s>$1</s>')
				.replace(/__(.*?)__/g, '<u>$1</u>')
				.replace(/\^\^(.*?)\^\^/g, '<sup>$1</sup>')
				.replace(/vv(.*?)vv/g, '<sub>$1</sub>')
				.replace(/#5([^ <>]*)/g, '<span style="font-size:20px">$1</span>')
				.replace(/#4([^ <>]*)/g, '<span style="font-size:18px">$1</span>')
				.replace(/#3([^ <>]*)/g, '<span style="font-size:16px">$1</span>')
				.replace(/#2([^ <>]*)/g, '<span style="font-size:14px">$1</span>')
				.replace(/#1([^ <>]*)/g, '<span style="font-size:12px">$1</span>')
				.replace(/http\:/g, 'https:')
				.replace(/https:\/\/paste.plurk.com\/show\/(.+?)(?!")\s\((.*?)\)/g, '<a href="https:\\\\paste.plurk.com\\show\\$1" class="ex_link plurkpaste" target="_blank">$2</a>')
				.replace(/https:\/\/(.+?) \((.+?)\)/ig, '<a href="https:\\\\$1" target="_blank" class="ex_link">$2</a>')
				.replace(/https:\/\/([^<> :]+?)(\.png|\.jpg|\.gif)(?!")/g, '<img src="https:\\\\$1$2">');
				let emoticonCount = 50;
				for(let key in random_list) {
					let re = new RegExp('(?!")\\(' + key + '\\)(?!")', 'i');
					while(content.search(re) > -1 && emoticonCount > 0) {
						content = content.replace(re, plurk_random(key));
						emoticonCount--;
					}
					re = new RegExp('(?!")\\(' + key + '\\)(?!")', 'ig');
					content = content.replace(re, '');
				}
				for(let emo in emo_list) {
					let re = new RegExp('\\[' + emo + '\\]', 'i');
					while(content.search(re) > -1 && emoticonCount > 0) {
						content = content.replace(re, emo_list[emo]);
						emoticonCount--;
					}
					re = new RegExp('\\[' + emo + '\\]', 'ig');
					content = content.replace(re, '');
				}
				return content;
			}
			function plurk_random(key) {
				if(key == '(拉霸|拉霸機|吃角子老虎|柏青嫂|slot|777|pachislot|パチスロ)') {
					let str = '';
					for(let f=0; f<3; f++) str += plurk_random_sub(key);
					return str;
				}
				else return plurk_random_sub(key);
			}
			function plurk_random_sub(key) {
				let result = get_random_result(key);
				
				let url_head = 'https://s.plurk.com/emoticons/';
				if(key == 'bz{1,3}') url_head += 'special/';
				else url_head += 'random/';
				
				let img_data = [
					'src="' + url_head + result.url + '"',
					'class="emoticon pugether_dice"',
					'alt="' + random_list[key].alt + '"',
					'rndnum="' + result.rndnum + '"'
				];
				return '<img ' + img_data.join(' ') + '>';
			}
			function get_random_result(key) {
				if(random_list[key].special) {
					let random = Math.floor(Math.random() * 10000);
					for(let bound in random_list[key].special)
						if(random < +bound)
							return random_list[key].special[bound];
				}
				let random = Math.floor(Math.random() * random_list[key].normal.length);
				return random_list[key].normal[random];
			}
			var ms = [
				['\\[b-([^\\[]*?) ([^\\[]*?) ([^\\[]*?)\\]', '<span style="background:$1; color:$2">$3</span>'],
				['\\[([^\\[]*?) ([^\\[]*?)\\]', '<span style="color:$1">$2</span>']
			];
			var random_list = {
				'bz{1,3}': {
					alt: '(bzzz)',
					normal: [
						{url: '221bfc45407f806956dc7ed96a8196f4.png', rndnum: 1},
						{url: '19acfc995b239be115f8988944bda0f2.png', rndnum: 2},
						{url: '687d3fb2eb1e2208dcd0404ff55cbf41.png', rndnum: 3},
						{url: '2c33223977362c0ed304b4d3711e1678.png', rndnum: 4}
					]
				},
				'(六面骰|骰子|dice|dice6)': {
					alt: '(dice)',
					normal: [
						{url: '982b22808f930c44a01f7723c2f8b8d4.png', rndnum: 1},
						{url: 'f1f556d49cb33bb46c6170166ac6b48c.png', rndnum: 2},
						{url: 'd4170e997ff7f06ccb56a4f4c07e0de0.png', rndnum: 3},
						{url: '8b6ff6c05dc1c3b74e4715440e557954.png', rndnum: 4},
						{url: '91d962f675106769795825d8eab51174.png', rndnum: 5},
						{url: '72d18a49f6c6619c7c9e1b9828688770.png', rndnum: 6}
					]
				},
				'(猜拳|剪刀石頭布|rock-paper-scissors|paper-scissors-stone)': {
					alt: '(rock-paper-scissors)',
					normal: [
						{url: '8f1e95d6bd23cedbc6005acbc9a059e8.png', rndnum: 'scissors'},
						{url: '36e84c21fad4a35f60aecc3b439e627e.png', rndnum: 'rock'},
						{url: '516a706919ab3e97f16723e16d7adfe8.png', rndnum: 'paper'}
					]
				},
				'(抽籤|draw|lots)': {
					alt: '(lots)',
					normal: [
						{url: '146a529d218c82d86ce630ad135ede10.png', rndnum: 1},
						{url: 'c1e3d416fda7b3022d7d3d43caf5ec39.png', rndnum: 2},
						{url: '19aaf586d123ed95a4d9414c91309b5a.png', rndnum: 3},
						{url: '0752b1b17348da8076abf6a1e4f894f2.png', rndnum: 4},
						{url: 'd4ab31cf460a3561ae4acb294df5b071.png', rndnum: 5},
						{url: '0b0a0376f1cc0d8a689d50a8bfb0f577.png', rndnum: 6},
						{url: '4de662cc268c20cac0489f662b3d2009.png', rndnum: 7}
					]
				},
				'(四面骰|dice4)': {
					alt: '(dice4)',
					normal: [
						{url: '551cd00a0755c2bf3c6250ff9cdca6f9.png', rndnum: 1},
						{url: '6c42bc8a8ac354736e290bd5db9991bc.png', rndnum: 2},
						{url: '72a3d1094d456751e0279746ee492fc2.png', rndnum: 3},
						{url: 'dc596798287f11c058094fa0c30f9525.png', rndnum: 4}
					]
				},
				'(硬幣|coin)': {
					alt: '(coin)',
					normal: [
						{url: 'd507b324a36b6ea37d41.png', rndnum: 1},
						{url: '8e944c265a5f5c871103.png', rndnum: 2}
					],
					special: {
						'4': {url: '06e09b76d9546853e495.png', rndnum: 3},
						'20': {url: '9fb1e388404d87547302.png', rndnum: 4}
					}
				},
				'(拉霸|拉霸機|吃角子老虎|柏青嫂|slot|777|pachislot|パチスロ)': {
					alt: '(slot)',
					normal: [
						{url: 'd266f2b19c50547d685a.png', rndnum: 1},
						{url: 'b664fae82506940d186a.png', rndnum: 2},
						{url: '901141e014eafb10e634.png', rndnum: 3},
						{url: '099e27858ca80d40ea77.png', rndnum: 4},
						{url: 'ee685fcb6cace2d84a97.png', rndnum: 5},
						{url: '34dc6e17eeb7fba38fd9.png', rndnum: 6},
						{url: '58daf7473a03d11b75fc.png', rndnum: 7},
						{url: '45c7ea63fee78d7817c3.png', rndnum: 8},
						{url: 'dd85f496eaf6dbaf3bd2.png', rndnum: 9},
						{url: 'b60c9c247bd2cff9c12c.png', rndnum: 10}
					]
				},
				'(內褲|胖次|panties|underpants|neiku|パンツ)': {
					alt: '(panties)',
					normal: [
						{url: '33c00e17af8a88e965f6.png', rndnum: 1},
						{url: 'c6b85173163ce38a4e58.png', rndnum: 2},
						{url: 'c00ef6a67f8a10c2f23b.png', rndnum: 3},
						{url: '123b06f8fcaedfe14ed4.png', rndnum: 4},
						{url: '6a243a33d6bc7459e4f9.png', rndnum: 5},
						{url: '687a18280c3fb912d969.png', rndnum: 6},
						{url: 'bc6ac1a469c2ac631e83.png', rndnum: 7},
						{url: 'bf9cfbccaf05ac783e03.png', rndnum: 8},
						{url: '462a87c36a676ba31fb5.png', rndnum: 9},
						{url: 'd4cd8da468b6e43eaa52.png', rndnum: 10}
					],
					special: {
						'19': {url: 'e814a02b915c32da9260.png', rndnum: 11}
					}
				},
				'dice2': {
					alt: '(dice2)',
					normal: [
						{url: 'e03a96e399fcca77ffd3.png', rndnum: 1},
						{url: '1896200c1e754d267422.png', rndnum: 2},
						{url: 'cc4b3dac9c182d3d1fff.png', rndnum: 3},
						{url: '6bc5739875f25a07d93a.png', rndnum: 4},
						{url: '41ab729fcbf9af3eeb25.png', rndnum: 5},
						{url: 'af9f5a32a5330e19e713.png', rndnum: 6}
					],
					special: {
						'12': {url: '8b133831d98791b4236f.png', rndnum: 7}
					}
				},
				'(擲筊|bobei)': {
					alt: '(bobei)',
					normal: [
						{url: 'd2f7dc304038dc31efd7.png', rndnum: 1},
						{url: 'b6ef58ae5a0aa2b9b695.png', rndnum: 2},
						{url: '943865002a968c3d5e56.png', rndnum: 3},
						{url: 'c3bcda880640aab9b964.png', rndnum: 4}
					],
					special: {
						'15': {url: '6cd31e91f76d5a61fbce.png', rndnum: 5}
					}
				},
				'(八面骰|dice8)': {
					alt: '(dice8)',
					normal: [
						{url: '88a52c6e32e6cc05c037.png', rndnum: 1},
						{url: 'a2eaef63a4a11c22806a.png', rndnum: 2},
						{url: '127703207e1918e65ac1.png', rndnum: 3},
						{url: 'e18e8df8959af17f4239.png', rndnum: 4},
						{url: '49aa89505c7eb433f351.png', rndnum: 5},
						{url: 'fb041d2f4c0668fb1e5d.png', rndnum: 6},
						{url: '1208e2e9e63fb3a94661.png', rndnum: 7},
						{url: 'def92e11a48e30c83e22.png', rndnum: 8}
					]
				},
				'(十面骰|dice10)': {
					alt: '(dice10)',
					normal: [
						{url: 'f43a5e47a6561a3f6b12.png', rndnum: 1},
						{url: 'b76ba53e929515139340.png', rndnum: 2},
						{url: '7d1bd4c6cc8ae5daef15.png', rndnum: 3},
						{url: '05520bea6bbb10548ebe.png', rndnum: 4},
						{url: '219ad40368d295f53046.png', rndnum: 5},
						{url: '4ebd7104e4691b3252ce.png', rndnum: 6},
						{url: '4b83419361369abf8981.png', rndnum: 7},
						{url: 'f1a5df7cc002f2dd3bf4.png', rndnum: 8},
						{url: '86da4434661161de12fe.png', rndnum: 9},
						{url: 'b7211fe31f31a313972b.png', rndnum: 10}
					]
				},
				'(十二面骰|dice12)': {
					alt: '(dice12)',
					normal: [
						{url: '38692497ec7d9e38e680.png', rndnum: 1},
						{url: 'de7fc19bf8e42203fe24.png', rndnum: 2},
						{url: 'c68b0a52b3f29617db63.png', rndnum: 3},
						{url: '078c6689bbe65e636224.png', rndnum: 4},
						{url: 'c76381a18ac93d159443.png', rndnum: 5},
						{url: '3991720115dd223b247c.png', rndnum: 6},
						{url: '173846390ed30621922b.png', rndnum: 7},
						{url: '1afd520db328caeea4e0.png', rndnum: 8},
						{url: '98ff46b0e0df5df8e5a8.png', rndnum: 9},
						{url: '00d280b8428f28bf6c2f.png', rndnum: 10},
						{url: '35659fe81dd4f6997e25.png', rndnum: 11},
						{url: '14a82a94262e04e87a0f.png', rndnum: 12}
					]
				},
				'(二十面骰|dice20)': {
					alt: '(dice20)',
					normal: [
						{url: '6fe0f0f6feb00f0d3682.png', rndnum: 1},
						{url: '64625f49a88ae0f38f03.png', rndnum: 2},
						{url: 'b45a20be607851a481b2.png', rndnum: 3},
						{url: '4b99448f9bafa31a9bd4.png', rndnum: 4},
						{url: 'e2b46b8b7fdf864671d8.png', rndnum: 5},
						{url: 'd003351e1793294885d7.png', rndnum: 6},
						{url: '7ed5ce27e95f4d7c450f.png', rndnum: 7},
						{url: '6ca299d07588a7746db1.png', rndnum: 8},
						{url: '5421081941d0283c63ac.png', rndnum: 9},
						{url: 'b6c38b708f27abfa9cd6.png', rndnum: 10},
						{url: '80a733a872c058570607.png', rndnum: 11},
						{url: '1f4ff46f9aec7d78d0b6.png', rndnum: 12},
						{url: '6f3eb952a7abad87509c.png', rndnum: 13},
						{url: 'dd5c5a79cfb46a789d03.png', rndnum: 14},
						{url: '68e84d60c39fde1936c3.png', rndnum: 15},
						{url: 'cc5a5024f251b5ba6917.png', rndnum: 16},
						{url: '02a215f8c2df5a68234a.png', rndnum: 17},
						{url: 'b46a6b76d9efecb00aca.png', rndnum: 18},
						{url: '70a9a3eddddb3327cf34.png', rndnum: 19},
						{url: 'e50a1234389ce7d0fa2d.png', rndnum: 20}
					]
				},
				'(數字骰|digit|dice09)': {
					alt: '(digit)',
					normal: [
						{url: '2395f06061976e760876.png', rndnum: 0},
						{url: '2381b5413267e90a9a69.png', rndnum: 1},
						{url: '885fd5b3e16d29523bae.png', rndnum: 2},
						{url: '78ffc26f57c1b011ea9f.png', rndnum: 3},
						{url: '38a74bf02493f7f89ced.png', rndnum: 4},
						{url: '8c1b835ae84f72e476b3.png', rndnum: 5},
						{url: '1befc83514dcc0e5f5f6.png', rndnum: 6},
						{url: '13b8f7060a19f97d1266.png', rndnum: 7},
						{url: '62a0e6546523e72001f2.png', rndnum: 8},
						{url: '85abfaae4c43484636a7.png', rndnum: 9}
					]
				}
			};
			var emo_list = {
				'肉骨獸': '<img src="https://s.plurk.com/emoticons/basic2/2e948ae7195e68b97ac54fa5bc93245e.gif" class="emoticon">',
				'愛心': '<img class="emoticon_my" src="https://emos.plurk.com/620e94a857470c40343878c0e558dc21_w24_h24.gif">',
				'害羞': '<img class="emoticon_my" src="https://emos.plurk.com/4609627770b8cfbe9b1599923adc3ff6_w24_h24.gif">',
				'亮晶晶': '<img class="emoticon_my" src="https://emos.plurk.com/186b1b32c713cbe4ef80614182c96a34_w24_h24.gif">',
				'小花': '<img class="emoticon_my" src="https://emos.plurk.com/1a848972c81d725e42351b8cfeee1177_w24_h24.gif">',
				'火': '<img class="emoticon_my" src="https://emos.plurk.com/1ca072ff2eb1d46f858648976603e80b_w24_h24.gif">',
				'咖啡': '<img class="emoticon_my" src="https://emos.plurk.com/ada878bee0cc24df7af91b8f227bc2fa_w24_h24.gif">',
				'汗滴': '<img class="emoticon_my" src="https://emos.plurk.com/4c9ff96ad6d23cf4c4b199db249454cc_w24_h24.gif">',
				'zzz': '<img class="emoticon_my" src="https://emos.plurk.com/5aecebfa3df284d293cd16fa006238b4_w24_h24.gif">',
				'大笑': '<img class="emoticon_my" src="https://emos.plurk.com/8e67570973b3ff9a77888a773d974fec_w48_h48.gif">'
			};
		</script>
	</body>
</html>